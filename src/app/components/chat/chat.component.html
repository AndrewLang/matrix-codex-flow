<div class="flex h-full min-h-0 flex-col gap-4 text-slate-200 p-3">
    <div class="relative flex-1 min-h-0">
        <section #transcriptContainer (scroll)="onTranscriptScroll()"
            class="h-full overflow-y-auto rounded-xl pr-2 py-8 backdrop-blur-xl "
            [ngClass]="{ 'bg-slate-900/60 border border-slate-800/80': !hasMessages(), 'bg-slate-900/30': hasMessages() }">
            <div class="space-y-6">
                @if (hasMessages()) {
                @for (message of messages(); track message.id) {
                <article class="flex" [ngClass]="bubbleLayout(message)">
                    <div class="flex flex-col gap-1.5" [ngClass]="bubbleAlign(message)">
                        <div class="w-full rounded-xl py-2 px-3 text-[15px] leading-7" [ngClass]="bubbleColor(message)">
                            <mtx-md-renderer [markdown]="message.content"></mtx-md-renderer>
                        </div>
                        <div class="flex items-center gap-1 px-2">
                            <time class="text-[11px] text-slate-500/90">
                                {{ message.createdAt | formatTimestamp }}
                            </time>
                            <button type="button"
                                class="grid h-6 w-6 place-items-center rounded text-slate-500 transition hover:bg-slate-700/60 hover:text-slate-300"
                                [attr.aria-label]="'Copy message'" (click)="copyMessage(message)">
                                <mtx-icon
                                    [icon]="copiedMessageId() === message.id ? 'check text-xs' : 'copy text-xs'"></mtx-icon>
                            </button>
                        </div>
                    </div>
                </article>
                }} @else {
                <div class="flex flex-col items-center gap-3 text-center">
                    <mtx-icon icon="chat text-4xl text-slate-500"></mtx-icon>
                    <p class="max-w-xs text-sm text-slate-500">No messages yet. </p>
                    <p class="max-w-xs text-sm text-slate-500">Start the conversation by asking a
                        question or giving a command.</p>
                </div>
                }
                @if (isReceiving()) {
                <mtx-loader label="Thinking..."></mtx-loader>
                }
            </div>
        </section>
        @if (showScrollToBottom()) {
        <button type="button"
            class="absolute bottom-4 right-6 grid h-10 w-10 place-items-center rounded-full border-2 border-amber-700 bg-slate-900/95 text-slate-200 shadow shadow-amber-600 transition hover:bg-slate-800"
            aria-label="Scroll to bottom" (click)="scrollToBottomFromButton()">
            <mtx-icon icon="arrow-down"></mtx-icon>
        </button>
        }
    </div>

    <div class="rounded-xl border border-slate-800/80 bg-slate-900/60 p-3 backdrop-blur-xl shadow-xl">
        <div class="flex flex-col gap-2">
            @if(isRunningTask()){
            <mtx-task-runtime></mtx-task-runtime>
            }
            @else {
            <!-- <textarea #composerTextarea
                class="w-full resize-none rounded-2xl bg-transparent px-2 py-2 text-[15px]leading-5 text-slate-200 placeholder:text-slate-500/90 focus:outline-none"
                [value]="composerText()" [style.min-height.px]="minComposerHeightPixels" rows="4"
                [style.max-height.px]="maxComposerHeightPixels" placeholder="Ask VibeFlow"
                (input)="onComposerInput($event)" (keydown)="onComposerKeydown($event)">
            </textarea> -->

            <mtx-md-editor [value]="composerText()" (valueChange)="composerText.set($event)" background="0f172a99"
                placeholder="Ask VibeFlow" (ctrlEnter)="sendMessage()"></mtx-md-editor>

            <div class="flex items-center justify-between border-t border-slate-800/80 pt-3">
                <div>
                    <span class="text-xs text-slate-500/90">GPT-5.3-Codex</span>
                </div>
                <button type="button"
                    class="h-9 w-9 place-items-center rounded-full bg-slate-800 text-slate-100 shadow-none transition hover:bg-slate-700"
                    aria-label="Send message" (click)="sendMessage()">
                    <mtx-icon icon="send text"></mtx-icon>
                </button>
            </div>
            }
        </div>
    </div>
</div>